# Do GRN-analysie in [pySCENIC](https://github.com/aertslab/pySCENIC.git)

**Brief**
  - Gene Regulatory Network (GRN) analysis is a powerful tool that illuminates the intricate web of gene regulation within cells. By unraveling the relationships between transcription factors and their target genes, GRN analysis provides critical insights into the fundamental processes that govern cellular function, development, and response to environmental cues.
  - pySCENIC is a lightning-fast python implementation of the SCENIC pipeline (Single-Cell rEgulatory Network Inference and Clustering) which enables biologists to infer transcription factors, gene regulatory networks and cell types from single-cell RNA-seq data.

**Contents**
- [Do GRN-analysie in pySCENIC](#do-grn-analysie-in-pyscenic)
  - [Quick Start](#quick-start)
  - [Comprehensive information](#comprehensive-information)
  - [Reference](#reference)
  - [Editor information](#editor-information)
---

## Quick Start
  - **Overview** pipeline consists of four main steps:
    1. *scdatacg*: Prepare input data by generating `.rds` and `.h5ad` files.
    2. *get_loom*: Extract the raw expression matrix from the Seurat object and convert it to `.loom` format.
    3. *pyscenic*: Run the pySCENIC workflow, including GRN inference, motif enrichment (ctx), and regulon activity scoring (AUCell).
    4. *plot*: Visualize results using SCENIC (R) for most plots, and pySCENIC (Python) to display regulon z-scores across different clusters.
  - **Variable**

| Variable names   | Types   | Required | Recommended value | Parameter description |
|------------------|---------|----------|-------------------|-----------------------|
| rdsORh5ad        | File    | yes      | -                 | Single-cell data file (either RDS or h5ad format) |
| tf_txt           | File    | yes      | -                 | Text file containing a list of transcription factor (TF) names (one per line) |
| tbl_file         | File    | yes      | -                 | File containing motif binding information for transcription factors |
| feather_file     | File    | yes      | -                 | Feather file containing motif ranking information for your species |
| rank_threshold   | Int     | yes      | 20000             | Rank threshold for identifying target genes of enriched motifs (default: 5000) |
| cluster_key      | String  | yes      | "cell"            | Key for clustering cells (used for plotting to visualize differences) |
| cpu              | Int     | yes      | 10                | Number of CPU cores to use for running pySCENIC |
| mem              | Int     | yes      | 50                | Amount of memory (in GB) to allocate for running pySCENIC |

  - **Need species-specific**
    The files `tf_txt`, `tbl_file`, and `feather_file` must be generated by running pySCENIC for your specific species. These files are not universal and are highly species-specific, so you need to build a database tailored to your organism.
    - If your species is *Arabidopsis thaliana*, you can directly download the pre-built *Arabidopsis thaliana* database, For more details, refer to [构建拟南芥pySCENIC的cistarget文件](https://github.com/ydgenomics/Scripts/blob/main/GRN-pySCENIC/create_cistarget_database/%E6%9E%84%E5%BB%BA%E6%8B%9F%E5%8D%97%E8%8A%A5pySCENIC%E7%9A%84cistarget%E6%96%87%E4%BB%B6.md).
      - [Ath_TF_list.txt](https://inner.stomics.tech/notebook/st/task-p20z10200n0035-ysygtkak/files/work/0.peanut/GRN/AT/output/Ath_TF_list.txt?_xsrf=2%7Cea536c0a%7C20f17ff539d654c1b150c81e102a5265%7C1748234517)
      - [AT_TF_binding_motifs_information.tbl](https://inner.stomics.tech/notebook/st/task-p20z10200n0035-ysygtkak/files/work/0.peanut/GRN/AT/output/AT_TF_binding_motifs_information.tbl?_xsrf=2%7Cea536c0a%7C20f17ff539d654c1b150c81e102a5265%7C1748234517)
      - [AT.regions_vs_motifs.rankings.feather](https://inner.stomics.tech/notebook/st/task-p20z10200n0035-ysygtkak/files/work/0.peanut/GRN/AT/output/AT.regions_vs_motifs.rankings.feather?_xsrf=2%7Cea536c0a%7C20f17ff539d654c1b150c81e102a5265%7C1748234517)
    
    - If your species is not a model organism and lacks sufficient information in [PlantTFDB](https://planttfdb.gao-lab.org/), such as *Arachis hypogaea* (peanut), you can map your species to a model species (e.g., *Arabidopsis thaliana*). For guidance, refer to [构建非模式物种花生pySCENIC的cistarget文件](https://github.com/ydgenomics/Scripts/blob/main/GRN-pySCENIC/create_cistarget_database/%E6%9E%84%E5%BB%BA%E9%9D%9E%E6%A8%A1%E5%BC%8F%E7%89%A9%E7%A7%8D%E8%8A%B1%E7%94%9FpySCENIC%E7%9A%84cistarget%E6%96%87%E4%BB%B6.md).
  - **Submit task with table**

| EntityID | rdsORh5ad | tf_txt | tbl_file | feather_file | rank_threshold | cluster_key | cpu | mem |
|----------|-----------|--------|----------|--------------|----------------|-------------|-----|-----|
| yd_test  | /Files/yangdong/pySCENIC/NB20250525080807qmkcrf01/H1314_dataget_Anno_rename_threelayers.cg_cgn.rds | /Files/yangdong/pySCENIC/NB20250525080807qmkcrf01/TF_gene_maped.txt | /Files/yangdong/pySCENIC/NB20250525080807qmkcrf01/TF_motifs_many2many.tbl | /Files/yangdong/pySCENIC/NB20250525080807qmkcrf01/peanut.regions_vs_motifs.rankings.feather | 20000 | cell | 10 | 50 |

## Comprehensive information
  - **Plotting Results**
  - **Interpretation of Results**
  - **Database**

## Reference 
> **Sincerely thank all teachers and researchers who provide open source resources**
> 1. [aertslab](https://scenic.aertslab.org/)
> 2. [pySCENIC](https://github.com/aertslab/pySCENIC.git)
> 3. [create_cisTarget_databases](https://github.com/aertslab/create_cisTarget_databases.git)
> 4. [PlantTFDB](https://planttfdb.gao-lab.org/)
> 5. [*老俊俊的生信笔记*·pyscenic 构建自己的 cisTarget 数据库](https://mp.weixin.qq.com/s/7-vKrLiFS4Tlkt-rHxEGeQ)
> 6. [*老俊俊的生信笔记*·pySCENIC 转录因子调控网络分析教程](https://mp.weixin.qq.com/s/9n1ITFcC3fT8uyQGlL3Qtw)
> 7. [单细胞pySCENIC](https://mp.weixin.qq.com/s/fECULduAzhbyv7BTzzqxFA)

## Editor information
  - **Editor:** yangdong(yangdong@genomics.cn), lili
  - **Github:** [ydgenomics](https://github.com/ydgenomics)
  - **Prospect:** Do interesting and competitive works, open source and make progress!
  - **Repository:** [Scripts/GRN-pySCENIC](https://github.com/ydgenomics/Scripts/tree/main/GRN-pySCENIC)
  - **Log:**
    - 20250526 第一次完成测试